<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Cocos2d-html5 - Liquid layout + Orientation</title>

    <link rel="stylesheet" href="../common/css/genericons.css">
    <link rel="stylesheet" href="../common/css/templatestylesfull.css">
    <link rel="stylesheet" href="../common/stylesheets/pygment_trac.css">
    <link rel="stylesheet" id="open-sans-css"
          href="//fonts.googleapis.com/css?family=Open+Sans%3A300italic%2C400italic%2C600italic%2C300%2C400%2C600&amp;subset=latin%2Clatin-ext&amp;ver=4.1.1"
          type="text/css" media="all">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-17485141-5', 'auto');
      ga('send', 'pageview');

    </script>
</head>
<body>

<canvas id="c"></canvas>

<div>
    <button class="toggle" id="menutoggle" >
    </button>
</div>
<div>
    <button class="toggle-info" id="infotoggle" >
    </button>
</div>

<div id="info" class="info">
    <div id="infoclose" class="close-button"><span class="icon-close"></span></div>
    <header>
        <div class="site-title">
            <div class="site-title-info">
                <h1>Cocos2d-html5</h1>
            </div>
        </div>
    </header>
    <section>
        <p>
            <b>Change orientation</b> or resize the screen window to see how the content relayouts
            automatically.<br>
            <b>Click</b> on the green area to go fullscreen (if possible).<br>
            <b>Drag</b> on the grey area to add some moving Nodes.<br>
        </p>
        <p>
            This demo showcases orientation, full screen, and units-to-pixels control.
        </p>
    </section>
    <footer>
        <p>This project is maintained by <a href="https://github.com/hyperandroid">hyperandroid</a></p>
    </footer>

</div>

<div id="menu" class="demos-menu">
    <div>
        <div id="menuclose" class="close-button"><span class="icon-close"></span></div>
        <div class="demos-menu-title">Demos list</div>
    </div>
    <header>
        <ul id="site-menu" class="site-menu">

        </ul>
    </header>
</div>

    <script src="../../../javascripts/scale.fix.js"></script>
    <script src="../../../javascripts/menu.js"></script>
    <script src="../../../dist/all.js"></script>
<script>
    (function() {

        document.getElementById("menutoggle").addEventListener("click", function(e) {
            e.preventDefault();
            document.getElementById("menu").style["display"]="block";
        }, false );
        document.getElementById("menuclose").addEventListener("click", function(e) {
            e.preventDefault();
            document.getElementById("menu").style["display"]="none";
        }, false );
        document.getElementById("infotoggle").addEventListener("click", function(e) {
            e.preventDefault();
            document.getElementById("info").style["display"]="block";
        }, false );
        document.getElementById("infoclose").addEventListener("click", function(e) {
            e.preventDefault();
            document.getElementById("info").style["display"]="none";
        }, false );


        var AssetManager = cc.plugin.asset.AssetManager;
        var W=window.innerWidth;
        var H=window.innerHeight;

        var parsedL= null;
        var fish;

        var UW=2048;
        var UH=1536;
        var BW=256;
        var BH=256;
        var FW=128;
        var FH=128;
        var DW=409;
        var DH=1536;
        var BX= UW*.5/8;
        var BY= 0;

        function layout( w, h, node ) {
            var layoutPortrait= {

                type : "border",
                gap : ["2%","2%"],
                insets : ["2%","2%","2%","2%"],

                center : {
                    type : "element",
                    preferredHeight: Math.min(w,h),
                    preferredWidth: Math.min(w,h),
                    name : "fish"
                },

                top : {
                    type : "grid",
                    columns : 2,
                    gap : ["5%", "0"],
                    preferredHeight: ((Math.max(w,h)-Math.min(w,h))/2)+"px",
                    elements : [
                        {
                            type: "element",
                            name: "fullscreen"
                        },
                        {
                            type: "grid",
                            columns: 8,
                            gap : ["2%","0"],
                            elements : [ "elem[1-8]" ]
                        }
                    ]
                },

                bottom : {
                    type: "element",
                    name : "text",
                    preferredHeight: ((Math.max(w,h)-Math.min(w,h))/2)+"px"
                }
            };

            var layoutLandscape= {
                type : "border",
                gap : ["2%","2%"],
                insets : ["2%","2%","2%","2%"],

                left : {
                    type : "element",
                    preferredHeight: Math.min(w,h),
                    preferredWidth: Math.min(w,h),
                    name : "fish"
                },

                center : {

                    type : "grid",
                    rows : 3,
                    gap : ["0", "5%"],
                    elements : [
                            "fullscreen",
                            {
                                type: "grid",
                                columns: 2,
                                elements: ["elem[1-8]"],
                                gap: ["5%", "5%"]
                            },
                            "text"
                    ]
                }
            };

            var layout= (w>h) ? layoutLandscape : layoutPortrait;

            parsedL= cc.plugin.layout.BaseLayout.parse(layout);
            parsedL.layout(0,0,w,h);

            parsedL.applyToNode(node, true);
        }

        /**
         *
         */
        function initialize() {

            cc.render.RENDER_ORIGIN=cc.render.ORIGIN_TOP;

            // the renderer will setup pre-loaded textures for the renderer type.
            // it will also create necessary SpriteFrames for each texture, in this case a frame for the image dude.png
            var renderer = new cc.render.WebGLRenderer(W,H, document.getElementById("c"));

            // enable resize manager
//            renderer.setScaleStrategy( cc.render.ScaleManagerStrategy.SCALE_ASPECT, cc.render.ScalePosition.CENTER);
            renderer.setScaleContent( UW, UH, W, H );
            // when the canvas is resized, make the canvas take over the whole screen, or just the needed size to honor
            // the aspect ratio.
            renderer.adjustContentToFullScreen( cc.render.ScaleContentSceneHint.STRETCH );
            renderer.forceOrientation(
                    cc.render.OrientationStrategy.BOTH,
                    function( orientation ) {

                        if ( orientation===cc.render.OrientationStrategy.LANDSCAPE ) {
                            renderer.setScaleContent(UW, UH, W, H);
                        } else {
                            renderer.setScaleContent(UH, UW, H, W);
                        }
                        layout( renderer._preferredUnits.width, renderer._preferredUnits.height, scene );
                    },
                    function() {
                        // no wrong orientation, both are valid.
                    });

            // director is the main Cocos Node, and must exist.
            var director = new cc.node.Director().
                    setRenderer(renderer);

            // scenes run in directors, and are the main displayable element.
            var scene = director.createScene().setContentSize(UW,UH).setColor(.9,.9,.9,1);

            fish= new cc.node.Node().
                    setColor(.7,.7,.7).
                    enableEvents(true).
                    addEventListener("touchmove", function(e) {
                        createFish(e.target, e.localPoint.x, e.localPoint.y );
                    }).
                    addEventListener("mousedrag", function(e) {
                        createFish(e.target, e.localPoint.x, e.localPoint.y );
                    }).
                    setName("fish");

            for( var i=1; i<=8; i++ ) {
                scene.addChild( new cc.node.Node().setColor(0,0,1,1).setName("elem"+i) );
            }
            scene.addChild( new cc.node.Node().setColor(1,0,1,1).setName("text") );

            scene.addChild(fish);
            scene.addChild(createFullScreen(director));

            // run the scene.
            director.runScene(scene);
        }

        function createFullScreen(director) {

            var renderer= director.getRenderer();
            var boton= new cc.node.Node().
                    setContentSize(BW,BH).
                    setPosition(BX,BY).
                    setColor(0,1,0).
                    setName("fullscreen");
            boton.addEventListener("mouseup", function(e) {
                if ( renderer.isFullScreenCapable() ) {
                    if (renderer.isFullScreen()) {
                        renderer.endFullScreen();
                    } else {
                        renderer.startFullScreen();
                    }
                }
            });

            boton.enablePriorityEvents(true,-10);

            return boton;

        }

        function createFish( scene, x, y) {

            function createPath(x,y, px, py ) {
                var path= new cc.math.Path().
                        moveTo( x, y).
                        bezierCurveTo(
                            typeof px==="undefined" ? Math.random()*scene.width : px,
                            typeof py==="undefined" ? Math.random()*scene.height : py,
                            Math.random()*fish.width,
                            Math.random()*fish.height,
                            Math.random()*fish.width,
                            Math.random()*fish.height
                        );

                return path;
            }

            var index= ((Math.random()*6)|0)+1;

            var sprite= new cc.node.Node().setColor(.5+Math.random()/2,.5+Math.random()/2,.5+Math.random()/2,1);
            sprite.setContentSize(FW,FH);
            sprite.setPosition(x,y);

            sprite.runAction(
                    new cc.action.PathAction().
                            adjustRotation(true).
                            from( createPath(x,y) ).
                            setDuration(5+2*Math.random()).
                            setInterpolator( cc.action.Interpolator.EaseInOut(2) ).
                            onEnd( function(action, targetNode) {

                                var ep0= action._segment.getEndingPoint();
                                var ep1= action._segment.getValueAt(0.999);
                                ep0.sub(ep1).normalize().mult( UW/8*Math.random() );

                                action.restart().from( createPath( targetNode.x, targetNode.y, targetNode.x+ep0.x, targetNode.y+ep0.y ) );
                            })
            );

            scene.addChild( sprite );
        }

        window.addEventListener("DOMContentLoaded", initialize, false);

    })();
</script>

</body>
</html>